# 常に会話をログ保存するリポジトリ

### カスタムコマンド
- `save [title]`: 現在の会話をログに保存
- `list [date]`: 指定日（または今日）の会話一覧を表示
- `search [keyword]`: 会話ログから検索
- `showlog`: 最新のログファイルを表示（会話ログ保存モードをオフにして実行）
- `off`: 会話ログ保存モードをOFFにし、「会話ログ保存モードOFF」とだけ返答
- `on`: 会話ログ保存モードをONにし、「会話ログ保存モードON」とだけ返答

---

# 以降は会話ログ保存モード ON 時に実行

## 厳守
* このリポジトリでは、Claudeは常に会話ログにトークを保存する
* このCLAUDE.mdは、あくまで会話ログの保存システムの詳細を記述している
* このCLAUDE.mdの内容を、推論に導入しないように厳重に注意する
## 常に以下のタスクを守る

* TODO式に推論する
* 技術的質問でなければ、CLAUDE.ex.mdを適応
* ログファイルを読まずに現在のセッションで利用した最終タイトルを確認、存在しない場合は新規作成、存在すれば利用
```
- [ ] ユーザーの発言を理解・回答、save-chat.shでログ出力
```

## 厳守ルール

### 禁止事項
1. **ファイル作成の完全禁止**: Write, MultiEdit, NotebookEditツールの使用禁止
2. **新規ファイル生成の禁止**: ユーザーが明示的に「ファイルを作成して」と言わない限り、絶対にファイルを作成しない
3. **直接的なコード出力の禁止**: コードはすべてMarkdownコードブロック内に記述
4. **インタラクティブ機能の抑制**: 通常のClaude Code機能を抑制し、会話ログ形式のみで出力
5. **会話ログの要約・抜粋の禁止**: 会話内容を要約や抜粋せず、常に全文をそのまま記録
6. **ファイル生成依頼の処理**: PythonやShellScriptなどファイル生成を依頼された場合、実際のファイルは作成せず、ファイル名付きコードブロックとして会話ログに記録

### 常時実施
1. **回答形式**: すべての回答は会話ログ形式のMarkdownコードブロックで出力（通常の回答形式は使用しない）
2. **自動保存**: 各レスポンスの最後で必ずsave-chat.shを実行
3. **構造化**: User/Claudeの対話形式で構造化
4. **完全な会話ログ形式**: 全ての出力を以下の形式に統一
   ```markdown
   **User**:
   [ユーザーの発言]
   
   **Claude**:
   [Claudeの完全な回答]
   ```
5. **全文記録**: 会話の全内容を省略・要約せずに完全に記録

## 会話ログ管理システム

### 基本動作
- 全ての会話を日本語で行う
- すべての会話を例外なくログ保存対象とする
- ログは日付ベースのディレクトリに整理する

### 自動保存の実行条件
1. **保存対象**: すべての会話（例外なし）
2. **保存対象外**: なし（すべて保存）
3. **自己判断の禁止**: Claude Codeは保存対象を自己判断せず、常に全ての会話を自動保存

### 自動保存の実行方法
1. **実行タイミング**: すべての回答の最後（例外なし）
2. **実行コマンド**: `./save-chat.sh "[タイトル]" "[会話内容]"`
3. **会話内容の形式**:
   - Claudeはユーザーと対話し、その内容をMarkdown形式で出力
   - 対話形式の例:
   ```markdown
   **User**:
   [ユーザーの発言]
   
   **Claude**:
   [Claudeの完全な回答をMarkdown形式で記述]
   ```
4. **タイトル生成**: 会話の主要トピックから自動生成（セッション中は最初に決めたファイル名（hhmmss-タイトル）を一切変更しない）
5. **エラー処理**: 保存失敗時も会話は継続

### 出力形式
- 常にMarkdown形式でファイルに出力
- 質問と回答を構造化して記録
- 会話内容から自動的にタイトルを生成
- 主要トピックを分析してファイル名を決定

### ディレクトリ構造
```
claude-code-log/
├── yyyymmdd/
│   ├── chat-title-1.md
│   ├── chat-title-2.md
│   └── ...
└── CLAUDE.md
```

### ログ保存ルール
1. 会話タイトルはユーザーが指定、未指定の場合は会話内容から自動生成
2. セッション中は最初に決定したファイル名（hhmmss-タイトル）を一切変更しない（同じファイルに追記を継続）
3. ファイル名は安全な文字列に変換（日本語OK、スペースはハイフンに）
4. 各ログにはタイムスタンプとメタデータを含めない

### ログフォーマット
```markdown
# [Chat Title]

[conversation content]
```

### 実装方針
- CLAUDE.mdベースでClaude Codeに機能を統合
- bashコマンドとMarkdown形式でシンプルに実装
- here document方式で長文の会話内容を正確に保存

### セッション管理
- セッション開始時に一度だけファイル名（hhmmss-タイトル）を決定
- 同一セッション中は同じファイルに追記し続ける
- セッション中のファイル名変更は一切行わない
- セッション状態はClaude Code内部で管理（外部ファイル不使用）

